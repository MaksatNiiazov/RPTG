{% extends "base.html" %}
{% load static %}
{% load inventory_tags %}

{% block content %}
<style>
  .inventory-container {
    display: flex;
    gap: 2rem;
    flex-wrap: wrap;
  }

  .block {
    flex: 1;
    min-width: 400px;
  }

  .rarity-box {
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
    color: white;
    display: inline-block;
  }

  .legendary {
    animation: glow 1s infinite alternate;
  }

  @keyframes glow {
    0%   { box-shadow: 0 0 5px gold; }
    100% { box-shadow: 0 0 15px gold; }
  }

  table {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 1rem;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
  }

  .empty-slot {
    color: #888;
    font-style: italic;
  }

  form {
    display: inline;
  }

  button {
    margin: 0 4px;
    padding: 4px 8px;
    cursor: pointer;
  }
</style>

<h1>{{ character.name }} ‚Äî –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏ –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</h1>

<div class="inventory-container">

  <div class="block">
    <h2>üéΩ –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</h2>
    <table>
      <tr>
        <th>–°–ª–æ—Ç</th>
        <th>–ü—Ä–µ–¥–º–µ—Ç</th>
        <th>–ë–æ–Ω—É—Å</th>
        <th>–í–µ—Å</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
      {% for slot, slot_label in character.inventory.equipped.model.SLOT_CHOICES %}
        {% with equipped_item=equipped|get_item:slot %}
        <tr>
          <td>{{ slot_label }}</td>
          {% if equipped_item %}
            <td>
              <span class="rarity-box {% if equipped_item.item.rarity.legendary %}legendary{% endif %}"
                    style="background-color: {{ equipped_item.item.rarity.color }};">
                {{ equipped_item.item.name }}
              </span>
            </td>
            <td>+{{ equipped_item.item.bonus }}</td>
            <td>{{ equipped_item.item.weight }} –∫–≥</td>
            <td>
              <form method="post" action="{% url 'characters:unequip-item' character.id equipped_item.slot %}">
                {% csrf_token %}
                <button type="submit">–°–Ω—è—Ç—å</button>
              </form>
            </td>
          {% else %}
            <td class="empty-slot" colspan="4">–ü—É—Å—Ç–æ</td>
          {% endif %}
        </tr>
        {% endwith %}
      {% endfor %}
    </table>
  </div>

  <div class="block">
    <h2>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
    <table>
      <tr>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–ö–æ–ª-–≤–æ</th>
        <th>–¢–∏–ø</th>
        <th>–†–µ–¥–∫–æ—Å—Ç—å</th>
        <th>–ë–æ–Ω—É—Å</th>
        <th>–í–µ—Å</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
      {% for entry in inventory_items %}
        <tr>
          <td>{{ entry.item.name }}</td>
          <td>{{ entry.quantity }}</td>
          <td>{{ entry.item.type.name }}</td>
          <td>
            <span class="rarity-box {% if entry.item.rarity.legendary %}legendary{% endif %}"
                  style="background-color: {{ entry.item.rarity.color }};">
              {{ entry.item.rarity.name }}
            </span>
          </td>
          <td>+{{ entry.item.bonus }}</td>
          <td>{{ entry.item.weight }} –∫–≥</td>
          <td>
            <form method="post" action="{% url 'characters:equip-item' character.id entry.item.id %}">
              {% csrf_token %}
              <button type="submit">–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </form>
            <form method="post" action="{% url 'characters:drop-item' character.id entry.item.id %}">
              {% csrf_token %}
              <button type="submit" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è?')">–£–¥–∞–ª–∏—Ç—å</button>
            </form>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="7">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç.</td>
        </tr>
      {% endfor %}
    </table>
  </div>

</div>
{% endblock %}
